var r,v=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});v.decode();var f=null;function b(){return(f===null||f.byteLength===0)&&(f=new Uint8Array(r.memory.buffer)),f}function L(e,t){return v.decode(b().subarray(e,e+t))}function C(){let e=r.init_emulator();return s.__wrap(e)}var E=0;function M(e,t){let n=t(e.length*1);return b().set(e,n/1),E=e.length,n}function k(e){let t=M(e,r.__wbindgen_malloc),n=E,o=r.init_emulator_with_rom(t,n);return s.__wrap(o)}function d(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`);return e.ptr}var p=null;function h(){return(p===null||p.byteLength===0)&&(p=new Int32Array(r.memory.buffer)),p}function B(e,t){return b().subarray(e/1,e/1+t)}function j(e){try{let l=r.__wbindgen_add_to_stack_pointer(-16);d(e,s),r.get_framebuffer(l,e.ptr);var t=h()[l/4+0],n=h()[l/4+1],o=B(t,n).slice();return r.__wbindgen_free(t,n*1),o}finally{r.__wbindgen_add_to_stack_pointer(16)}}function R(e){d(e,s);let t=r.run_sample(e.ptr);return c.__wrap(t)}function T(e,t){d(e,s),r.run_n_samples(e.ptr,t)}function q(e,t){d(e,s),r.press_button(e.ptr,t)}function z(e,t){d(e,s),r.release_button(e.ptr,t)}var x=new FinalizationRegistry(e=>r.__wbg_audiosamples_free(e)),c=class{static __wrap(t){let n=Object.create(c.prototype);return n.ptr=t,x.register(n,n.ptr,n),n}__destroy_into_raw(){let t=this.ptr;return this.ptr=0,x.unregister(this),t}free(){let t=this.__destroy_into_raw();r.__wbg_audiosamples_free(t)}get left(){return r.__wbg_get_audiosamples_left(this.ptr)}set left(t){r.__wbg_set_audiosamples_left(this.ptr,t)}get right(){return r.__wbg_get_audiosamples_right(this.ptr)}set right(t){r.__wbg_set_audiosamples_right(this.ptr,t)}},A=new FinalizationRegistry(e=>r.__wbg_gbhandle_free(e)),s=class{static __wrap(t){let n=Object.create(s.prototype);return n.ptr=t,A.register(n,n.ptr,n),n}__destroy_into_raw(){let t=this.ptr;return this.ptr=0,A.unregister(this),t}free(){let t=this.__destroy_into_raw();r.__wbg_gbhandle_free(t)}},m={__wbindgen_placeholder__:{__wbindgen_throw:function(e,t){throw new Error(L(e,t))}}};async function W(e){return(await O(e)).exports}var w,y;function O(e){return w!=null?Promise.resolve(w):(y==null&&(y=(async()=>{try{let t=(await P(e??{})).instance;return r=t.exports,p=new Int32Array(r.memory.buffer),f=new Uint8Array(r.memory.buffer),w={instance:t,exports:N()},w}finally{y=null}})()),y)}function N(){return{init_emulator:C,init_emulator_with_rom:k,get_framebuffer:j,run_sample:R,run_n_samples:T,press_button:q,release_button:z,AudioSamples:c,GbHandle:s}}async function P(e){let t=e.url??new URL("rs_lib_bg.wasm",import.meta.url),n=e.decompress,o=t.protocol==="file:";if(globalThis.process?.versions?.node!=null&&o){let a=await Deno.readFile(t);return WebAssembly.instantiate(n?n(a):a,m)}switch(t.protocol){case"file:":case"https:":case"http:":{if(o){if(typeof Deno!="object")throw new Error("file urls are not supported in this environment");"permissions"in Deno&&await Deno.permissions.request({name:"read",path:t})}else typeof Deno=="object"&&"permissions"in Deno&&await Deno.permissions.request({name:"net",host:t.host});let a=await fetch(t);if(n){let U=new Uint8Array(await a.arrayBuffer());return WebAssembly.instantiate(n(U),m)}return o||a.headers.get("content-type")?.toLowerCase().startsWith("application/wasm")?WebAssembly.instantiateStreaming(a,m):WebAssembly.instantiate(await a.arrayBuffer(),m)}default:throw new Error(`Unsupported protocol: ${t.protocol}`)}}var _=await W(),u=void 0,g=void 0,D=void 0,F=void 0,S=48e3,i=[];i.a=2;i.s=8;i.d=1;i.w=4;i.m=128;i.n=64;i.k=16;i.l=32;function I(e){g===void 0&&(g=e);let t=e-g;g=e;let n=Math.round(t*S/1e3);_.run_n_samples(u,n);let o=_.get_framebuffer(u),l=new ImageData(new Uint8ClampedArray(o),160,144);F.putImageData(l,0,0),window.requestAnimationFrame(I)}function $(){u=_.init_emulator(),D=document.getElementById("myCanvas"),F=D.getContext("2d"),document.getElementById("load_btn").addEventListener("change",function(){var t=new FileReader;t.onload=function(){let n=this.result,o=new Uint8Array(n);_.destroy_emulator(u),u=_.init_emulator_with_rom(o),console.log(o)},t.readAsArrayBuffer(this.files[0])},!1),document.addEventListener("keydown",t=>{let n=i[t.key];n!=null&&_.press_button(u,n)},!1),document.addEventListener("keyup",t=>{let n=i[t.key];n!=null&&_.release_button(u,n)},!1),window.requestAnimationFrame(I)}$();
